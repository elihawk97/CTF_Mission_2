import wave
import numpy as np

def append_message_to_audio(audio_filename, binary_message, output_filename):
    # Load the existing audio file
    with wave.open(audio_filename, 'rb') as wav_file:
        params = wav_file.getparams()  # Get the original file's parameters
        audio_data = wav_file.readframes(wav_file.getnframes())  # Read the audio data

    # Convert binary message to a string
    byte_array = bytearray()
    for i in range(0, len(binary_message), 8):
        byte = binary_message[i:i+8]
        byte_array.append(int(byte, 2))

    message = byte_array.decode('ascii')  # Decode binary to ASCII text

    # Convert the message to samples (as ASCII characters)
    message_samples = np.frombuffer(message.encode('ascii'), dtype=np.uint8)

    # Combine the audio data and the message samples
    combined_data = np.frombuffer(audio_data, dtype=np.int16).astype(np.int16)
    padding = np.zeros(len(message_samples), dtype=np.int16)  # Pad with zeros to not alter the audio
    combined_data = np.concatenate((combined_data, padding))

    # Save the combined data to a new WAV file
    with wave.open(output_filename, 'w') as wav_file:
        wav_file.setnchannels(params.nchannels)  # Use original channel count
        wav_file.setsampwidth(params.sampwidth)  # Use original sample width
        wav_file.setframerate(params.framerate)  # Use original frame rate
        wav_file.writeframes(combined_data.tobytes())

    # Append the message at the end of the file as metadata (not interfering with audio)
    with open(output_filename, 'ab') as wav_file:
        wav_file.write(message.encode('ascii'))  # Append the ASCII message directly

# Example usage
binary_message = ("0101001100100000011001010010000001100011001000000111001000100000011001010010000001110100001000000010000000100000010011010010000001100101001000000111001100100000011100110010000001100001001000000110011100100000011001010010000000100000001000000111010100100000011100110010000001101001001000000110111000100000011001110010000000100000001000000111001100100000011110010010000001101101001000000110110100100000011001010010000001110100001000000111001000100000011010010010000001100011001000000010000000100000011001010010000001101110001000000110001100100000011100100010000001111001001000000111000000100000011101000010000001101001001000000110111100100000011011100010000000101100001000000010000000100000010101000010000001101111001000000111000000100000001000000010000001010011001000000110010100100000011000110010000001110010001000000110010100100000011101000010000000101100001000000010000000100000010001000010000001101111001000000010000000100000010011100010000001101111001000000111010000100000001000000010000001010011001000000110100000100000011000010010000001110010001000000110010100100000001110100010000000100000001000000011110100100000000001000010000000100000001000000001100100100000000101010010000000011010001000000010001100100000000101000010000000010110001000000010110100100000010000010010000000101110001000000000111000100000000111000010000000100101001000000000010100100000000110110010000000100110001000000010000000100000000110010010000000000100001000000100100100100000011101110010000001010000001000000101101100100000011010000010000001010010001000000101111000100000010011110010000001000100001000000110011000100000010100110010000001000111001000000111000100100000010110010010000001011110001000000101011000100000010000000010000001100110001000000101000100100000010001000010000001111101001000000101010100100000"
)
append_message_to_audio('arabic.wav', binary_message, 'combined_audio_secret.wav')
